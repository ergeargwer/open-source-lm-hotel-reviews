# 模型一致性分析工具 (Model Consistency Analysis Tool)

本工具專門用於分析多個語言模型與人工標註結果的一致性指標，支援多維度評估，包括情感分析、諷刺偵測、舒適度、價值、設施、位置、員工、清潔度和食物等維度。

## 📁 專案檔案結構

- **`模型一致性分析工具20251213.ipynb`**: 核心分析程式碼，包含所有一致性計算邏輯。
- **`multidimensional_analysis_results_SLM+人工_不含理由_刪除無效_刪除評論_標準名稱_20251112.csv`**: 輸入資料檔案，包含人工標註和各模型的分析結果。
- **`model_consistency_analysis_results.xlsx`**: 分析結果輸出檔案（由程式自動生成）。

## 🚀 功能特色

1. **多維度一致性分析**：
   - 支援 9 個評估維度：情感(sentiment)、諷刺(sarcasm)、舒適度(comfort)、價值(value)、設施(facilities)、位置(location)、員工(staff)、清潔度(cleanliness)、食物(food)
   - 每個維度使用適當的評級標準和映射規則

2. **多項一致性指標**：
   - **完成率 (Completion Rate)**：模型成功分析的評論比例
   - **準確率 (Accuracy)**：完全一致的評估比例
   - **宏觀 F1 分數 (Macro-F1)**：考慮類別不平衡的 F1 指標
   - **Off-by-1 準確率**：允許一級誤差的準確率（適用於順序性評級）

3. **總體指標計算**：
   - 結合完成率和準確率的懲罰性總體指標
   - 提供更全面的模型效能評估

4. **自動化輸出**：
   - 生成 Excel 檔案，包含多個工作表的分類結果
   - 支援欄位順序自定義和缺失欄位處理

## 🛠️ 環境需求與安裝

### Python 套件
請確保安裝以下 Python 套件：

```bash
pip install pandas numpy scikit-learn openpyxl
```

### 輸入資料格式
輸入 CSV 檔案應包含以下欄位結構：
- `Column1.key`: 評論唯一識別碼
- `Column1.model`: 模型名稱（人工標註標記為 '人工標註'）
- `Column1.analysis.{dimension}.level`: 各維度的評估結果

支援的評級標準：
- **情感分析**: 非常正面/正面/中立/負面/非常負面
- **諷刺偵測**: 有反諷/未提及
- **其他維度**: 非常好/好/一般/差/非常差/未提及

## 📖 使用說明

### 1. 準備資料
- 確保輸入 CSV 檔案位於程式目錄中
- 確認資料格式符合上述要求

### 2. 執行分析
在 Jupyter Notebook 中依序執行以下儲存格：

1. **安裝套件**：安裝必要的 Python 套件
2. **設定路徑**：定義輸入輸出檔案路徑
3. **執行分析**：運行一致性分析計算
4. **下載結果**：下載生成的 Excel 結果檔案

### 3. 輸出結果說明

程式會生成包含以下工作表的 Excel 檔案：

- **Completion_Rate**: 各模型的完成率統計
- **Overall_Accuracy**: 結合完成率的總體準確率
- **Overall_Off_by_1**: 結合完成率的總體 Off-by-1 準確率
- **Accuracy**: 各維度的完全一致率
- **Off_by_1_Accuracy**: 各維度的 Off-by-1 準確率
- **Macro_F1**: 各維度的宏觀 F1 分數

### 4. 自定義設定

如需修改分析參數，請編輯 Notebook 中的以下變數：
- `INPUT_CSV`: 輸入檔案路徑
- `OUTPUT_EXCEL`: 輸出檔案路徑
- `DIMENSION_MAPS`: 維度評級映射
- `final_column_order`: 輸出欄位順序

## 📊 分析指標解釋

### 完成率 (Completion Rate)
```
完成率 = (模型成功分析的評論數 / 人工標註總評論數) × 100%
```
表示模型處理資料的完整性。

### 準確率 (Accuracy)
```
準確率 = 完全一致的評估數 / 總比較數
```
衡量模型輸出與人工標註的完全匹配程度。

### Off-by-1 準確率
```
Off-by-1 = (差異 ≤ 1 級的評估數) / 總比較數
```
對於順序性評級，允許相鄰級別的誤差，提供更寬鬆的評估。

### 宏觀 F1 分數
```
Macro-F1 = 各類別 F1 分數的平均值
```
平衡精確率和召回率，適合多類別問題。

### 總體指標
```
總體準確率 = 準確率 × 完成率
```
懲罰處理不完整的模型，提供更現實的效能評估。

## 🔧 故障排除

### 常見問題
1. **檔案未找到錯誤**
   - 確認輸入 CSV 檔案存在且路徑正確
   - 在 Colab 中重新上傳檔案

2. **欄位缺失錯誤**
   - 檢查輸入資料是否包含所有必要欄位
   - 確認欄位名稱格式正確

3. **評級映射錯誤**
   - 確認評級值符合預定義的標準
   - 檢查是否有未預期的空值或異常值

### 效能優化
- 對於大型資料集，建議增加記憶體配置
- 可以修改 `final_column_order` 來自定義輸出順序
- 程式支援平行處理，但目前實作為單執行緒

## 📈 應用場景

本工具適用於：
- 語言模型效能評估
- 多模型比較分析
- 人工智慧系統驗證
- 品質控制和基準測試
- 研究論文的實證分析

## 🤝 貢獻

歡迎提交 Issue 和 Pull Request 來改進本工具。

## 📄 授權

本專案採用 MIT 授權條款。